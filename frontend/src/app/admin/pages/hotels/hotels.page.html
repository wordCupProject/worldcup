<main class="flex-1 p-6 min-h-[2000px]">
  <div class="container mx-auto">
    <!-- Messages de notification -->
    <div *ngIf="showSuccessMessage" class="success-message flex justify-between items-center mb-4">
      <div class="flex items-center">
        <i class="fas fa-check-circle text-green-600 mr-2"></i>
        {{ successMessage }}
      </div>
      <button (click)="dismissSuccessMessage()" class="text-green-800 hover:text-green-900">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div *ngIf="showErrorMessage" class="error-message flex justify-between items-center mb-4">
      <div class="flex items-center">
        <i class="fas fa-exclamation-circle text-red-600 mr-2"></i>
        {{ errorMessage }}
      </div>
      <button (click)="dismissErrorMessage()" class="text-red-800 hover:text-red-900">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="mb-8">
      <h1 class="text-3xl font-bold text-dark mb-2">Gestion des Hôtels</h1>
      <p class="text-gray-600">Administrez les hôtels partenaires de la Coupe du Monde Maroc 2030</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Formulaire -->
      <div class="bg-white rounded-xl shadow-lg p-6">
        <h2 class="text-xl font-bold text-dark mb-4">
          <i class="fas fa-plus-circle text-primary mr-2"></i> 
          {{ isEditing ? 'Modifier l\'hôtel' : 'Ajouter un nouvel hôtel' }}
        </h2>
        <form class="space-y-4" (submit)="isEditing ? updateHotel() : addHotel(); $event.preventDefault()">
          <div>
            <label class="block mb-2">Nom de l'hôtel</label>
            <input [(ngModel)]="hotelForm.name" name="name" class="w-full border rounded-lg px-4 py-2" placeholder="Ex: Hôtel Kenzi Tower" required />
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block mb-2">Ville</label>
              <select [(ngModel)]="hotelForm.city" name="city" class="w-full border rounded-lg px-4 py-2" required>
                <option value="" disabled>Sélectionnez une ville</option>
                <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
              </select>
            </div>
            <div>
              <label class="block mb-2">Étoiles</label>
              <select [(ngModel)]="hotelForm.stars" name="stars" class="w-full border rounded-lg px-4 py-2">
                <option *ngFor="let s of [5,4,3,2,1]" [value]="s">{{ s }}</option>
              </select>
            </div>
          </div>

          <div>
            <label class="block mb-2">Adresse</label>
            <input [(ngModel)]="hotelForm.address" name="address" class="w-full border rounded-lg px-4 py-2" required />
          </div>

          <div>
            <label class="block mb-2">Description</label>
            <textarea [(ngModel)]="hotelForm.description" name="description" rows="3" class="w-full border rounded-lg px-4 py-2"></textarea>
          </div>

          <div>
            <label class="block mb-2">Services proposés</label>
            <div class="grid grid-cols-2 gap-2">
              <label *ngFor="let key of serviceKeys" class="flex items-center">
                <input 
                  type="checkbox" 
                  [(ngModel)]="hotelForm.servicesMap[key]" 
                  [name]="key" 
                  class="mr-2" 
                /> {{ key }}
              </label>
            </div>
          </div>

          <div *ngIf="!isEditing">
            <label class="block mb-2">Photo</label>
            <input type="file" (change)="onFileSelected($event)" class="hidden" #fileInput />
            <div class="border-2 border-dashed rounded-lg h-32 flex items-center justify-center cursor-pointer hover:bg-gray-50" (click)="fileInput.click()">
              <div class="text-center">
                <i class="fas fa-cloud-upload-alt text-2xl text-gray-400 mb-2"></i>
                <p class="text-gray-500">Cliquez ou glissez une image ici</p>
              </div>
            </div>
          </div>

          <div class="flex justify-end mt-6">
            <button type="button" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg mr-3" (click)="isEditing ? closeEditModal() : resetForm()">
              {{ isEditing ? 'Annuler' : 'Réinitialiser' }}
            </button>
            <button type="submit" class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-red-600 flex items-center">
              <i class="fas fa-{{ isEditing ? 'save' : 'plus' }} mr-2"></i> 
              {{ isEditing ? 'Sauvegarder' : 'Ajouter l\'hôtel' }}
            </button>
          </div>
        </form>
      </div>

      <!-- Liste des hôtels -->
      <div>
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold">Liste des Hôtels</h2>
          <div class="relative">
            <input [(ngModel)]="searchQuery" class="pl-10 pr-4 py-2 rounded-lg border" placeholder="Rechercher un hôtel..." />
            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
          </div>
        </div>

        <div class="space-y-4">
          <div *ngFor="let hotel of paginatedHotels" class="bg-white rounded-xl shadow p-4">
            <img *ngIf="hotel.photoPath" [src]="hotelService.getImageUrl(hotel.photoPath)" class="w-full h-48 object-cover rounded" />
            <div class="mt-4">
              <h3 class="text-lg font-bold">{{ hotel.name }}</h3>
              <p class="text-sm text-gray-500">{{ hotel.city }} - {{ hotel.stars }} étoiles</p>
              <p class="text-gray-600 mt-2">{{ hotel.description }}</p>
              <div class="mt-2">
                <span *ngFor="let s of hotel.services" class="bg-gray-100 text-xs text-gray-700 px-2 py-1 rounded mr-2">{{ s }}</span>
              </div>
              <p class="text-gray-700 mt-2"><i class="fas fa-map-marker-alt mr-2 text-primary"></i>{{ hotel.address }}</p>
              <div class="flex space-x-2 mt-4">
                <button class="p-2 text-blue-600 hover:bg-blue-100 rounded" (click)="viewDetails(hotel)" title="Voir les détails">
                  <i class="fas fa-eye"></i>
                </button>
                <button class="p-2 text-green-600 hover:bg-green-100 rounded" (click)="editHotel(hotel)" title="Modifier">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="p-2 text-red-600 hover:bg-red-100 rounded" (click)="confirmDelete(hotel)" title="Supprimer">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Détails -->
  <div *ngIf="showModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" (click)="closeModal()">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl p-6" (click)="$event.stopPropagation()">
      <div class="flex justify-between items-start mb-4">
        <h2 class="text-2xl font-bold">Détails de l'Hôtel</h2>
        <button (click)="closeModal()" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="md:col-span-1">
          <ng-container *ngIf="selectedHotel?.photoPath as photo; else noPhoto">
            <img [src]="hotelService.getImageUrl(photo)" class="w-full h-48 object-cover rounded-xl" />
          </ng-container>
          <ng-template #noPhoto>
            <div class="bg-gray-200 border-2 border-dashed rounded-xl w-full h-48 flex items-center justify-center">
              <i class="fas fa-image text-gray-400 text-4xl"></i>
            </div>
          </ng-template>
        </div>
        <div>
          <h3 class="font-semibold text-lg mb-2">{{ selectedHotel?.name }}</h3>
          <p class="text-gray-600 mb-2">
            <i class="fas fa-map-marker-alt text-primary mr-2"></i>
            {{ selectedHotel?.city }} - {{ selectedHotel?.stars }} étoiles
          </p>
          <p class="text-gray-700 mb-3">{{ selectedHotel?.description }}</p>
          <p class="text-gray-600 mb-3">
            <i class="fas fa-home text-primary mr-2"></i>
            {{ selectedHotel?.address }}
          </p>
          <div class="mb-3">
            <h4 class="font-medium mb-2">Services disponibles :</h4>
            <div class="flex flex-wrap gap-1">
              <span *ngFor="let service of selectedHotel?.services" class="bg-primary text-white text-xs px-2 py-1 rounded">
                {{ service }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Édition -->
  <div *ngIf="showEditModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" (click)="closeEditModal()">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl p-6 max-h-[90vh] overflow-y-auto" (click)="$event.stopPropagation()">
      <div class="flex justify-between items-start mb-4">
        <h2 class="text-2xl font-bold">
          <i class="fas fa-edit text-green-600 mr-2"></i>
          Modifier l'Hôtel
        </h2>
        <button (click)="closeEditModal()" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form class="space-y-4" (submit)="updateHotel(); $event.preventDefault()">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block mb-2 font-medium">Nom de l'hôtel</label>
            <input [(ngModel)]="hotelForm.name" name="edit_name" class="w-full border rounded-lg px-4 py-2" required />
          </div>
          <div>
            <label class="block mb-2 font-medium">Ville</label>
            <select [(ngModel)]="hotelForm.city" name="edit_city" class="w-full border rounded-lg px-4 py-2" required>
              <option value="" disabled>Sélectionnez une ville</option>
              <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
            </select>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block mb-2 font-medium">Étoiles</label>
            <select [(ngModel)]="hotelForm.stars" name="edit_stars" class="w-full border rounded-lg px-4 py-2">
              <option *ngFor="let s of [5,4,3,2,1]" [value]="s">{{ s }}</option>
            </select>
          </div>
          <div>
            <label class="block mb-2 font-medium">Adresse</label>
            <input [(ngModel)]="hotelForm.address" name="edit_address" class="w-full border rounded-lg px-4 py-2" required />
          </div>
        </div>

        <div>
          <label class="block mb-2 font-medium">Description</label>
          <textarea [(ngModel)]="hotelForm.description" name="edit_description" rows="3" class="w-full border rounded-lg px-4 py-2"></textarea>
        </div>

        <div>
          <label class="block mb-2 font-medium">Services proposés</label>
          <div class="grid grid-cols-3 gap-2">
            <label *ngFor="let key of serviceKeys" class="flex items-center">
              <input 
                type="checkbox" 
                [(ngModel)]="hotelForm.servicesMap[key]" 
                [name]="'edit_' + key" 
                class="mr-2" 
              /> {{ key }}
            </label>
          </div>
        </div>

        <div class="flex justify-end mt-6 space-x-3">
          <button type="button" class="px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300" (click)="closeEditModal()">
            <i class="fas fa-times mr-2"></i>
            Annuler
          </button>
          <button type="submit" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
            <i class="fas fa-save mr-2"></i>
            Sauvegarder
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Suppression -->
  <div *ngIf="showDeleteModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" (click)="closeDeleteModal()">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6" (click)="$event.stopPropagation()">
      <div class="text-center">
        <div class="mb-4">
          <i class="fas fa-exclamation-triangle text-red-500 text-4xl mb-4"></i>
          <h2 class="text-xl font-bold text-gray-800 mb-2">Confirmer la suppression</h2>
          <p class="text-gray-600">
            Êtes-vous sûr de vouloir supprimer l'hôtel 
            <strong>"{{ hotelToDelete?.name }}"</strong> ?
          </p>
          <p class="text-sm text-red-500 mt-2">Cette action est irréversible.</p>
        </div>

        <div class="flex justify-center space-x-3">
          <button class="px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300" (click)="closeDeleteModal()">
            <i class="fas fa-times mr-2"></i>
            Annuler
          </button>
          <button class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 delete-confirm-btn" (click)="deleteHotel()">
            <i class="fas fa-trash mr-2"></i>
            Supprimer
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="flex justify-center items-center mt-6 space-x-4">
    <button (click)="goToPreviousPage()" 
            [disabled]="currentPage === 1"
            class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-sm rounded disabled:opacity-50">
      ◀ Précédent
    </button>
    <span class="text-gray-700 font-medium">Page {{ currentPage }} / {{ totalPages }}</span>
    <button (click)="goToNextPage()" 
            [disabled]="currentPage === totalPages"
            class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-sm rounded disabled:opacity-50">
      Suivant ▶
    </button>
  </div>
</main>